{% extends 'car_rental/layouts/dashboard_base.html' %}
{% load i18n allauth static %}

{% block head_title %}
  {% trans "Car maintenance" %}
{% endblock head_title %}

{% block extra_head %}
<style>
  #id_cost_of_repair_1 {
    display: none;
  }
</style>
{% endblock extra_head %}

{% block content %}
  <div class="row mb-3">
    <div class="col-12 col-md-4">
      <div class="h-100 d-flex align-items-center">
        <button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#maintenance-modal">
          {% trans "Add maintenance" %}
        </button>
      </div>
    </div>
    <div class="col-12 col-md-8 gy-2">
      <form method="get">
        <div class="row w-100">
          {{ filter.form.non_field_errors }}
          {% for field in filter.form %}
            {{ field.errors }}
            <div class="form-floating col-12 col-md-3 p-1">
              {{ field }}
              {{ field.label_tag }}
            </div>
          {% endfor %}
          <div class="col-12 col-md-3 p-1">
            <div class="h-100 d-flex align-items-center">
              <button class="btn btn-primary w-100" type="submit">Sort</button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div class="bg-body-secondary rounded p-2 mb-5">
    <div class="row row-cols-1 gy-2 pe-3">
      {% for maintenance in object_list %}
        <div class="bg-body-tertiary rounded p-2 mx-2 text-white">
          <div class="row">
            <div class="col-9">
              <div class="d-flex flex-column">
                <h3 class="fw-normal mb-3">
                  <a class="col text-decoration-none" href="{% url 'dashboard_car_update' maintenance.car.pk %}">
                    {{ maintenance.car }}
                  </a>
                </h3>
                <div class="d-flex flex-row">
                  <h5 class="fw-normal mb-3">
                    {% trans 'Date of repair' %} {{ maintenance.date_of_repair|date:'Y-m-d' }}
                  </h5>
                  <h5 class="fw-normal mb-3 mx-3">
                    {% trans 'Cost of repair' %} {{ maintenance.cost_of_repair }}
                  </h5>
                  <p class="rounded-pill info-pill
                    {% if maintenance.status == 'DO' %} bg-success 
                    {% elif maintenance.status == 'SCH' %} bg-info text-black 
                    {% elif maintenance.status == 'IR' %} bg-warning text-black
                    {% endif %} px-2"
                    data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="{% trans 'Status' %}">
                    {{ maintenance.get_status_display }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    {% include 'car_rental/dashboard/pagination.html' %}
  </div>

  {% include 'car_rental/dashboard/modals/maintenance_modal.html' %}
{% endblock content %}

{% block extra_body %}
  <script src="{% static 'js/car_rental/dashboard/maintenance_create.js' %}"></script>
  <script src="{% static 'bootstrap/js/tooltips.js' %}"></script>
{% endblock extra_body %}
